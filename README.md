
**This repo:**
- generating code:
  - generating_harness_cases: contains a script that, given MAVLINK messages in an xml, can generate a bunch of switch-case cases for increasing code coverage
  - generating_message_encoding: contains a script that, given mavlink xml, generates a bunch of functions that can be used to generate messages of that type to use as seeds for fuzzing

- generating_seeds
  - using results from generating_message_encoding and helper functions in function.py and constants in constants.py, generate a bunch of seeds for mavlink fuzzing

 - udp_example.c: an example of the test harness using results from generating harness cases


**Mavlink message definitions:**
https://github.com/mavlink/mavlink/blob/master/message_definitions/v1.0/common.xml

 **Fuzzing:**
 - clone this repo: https://github.com/WUSTL-CSPL/mavlink_fuzz_CSE569
 - place the udp_example.c file with one from this repo or one with a better harness
 - change CMakeLists.txt in examples/c (NOT the one in the first level of the repo) to the text below
 - run `cmake -Bbuild -H. -DCMAKE_PREFIX_PATH=$(pwd)/../../install`
- run `cmake --build build`
- once built you can fuzz `AFL_SKIP_CPUFREQ=1 AFL_USE_ASAN=1 AFL_USE_UBSAN=1 afl-fuzz -i input -o output -- ./build/udp_example @@`, make sure input is the seeds generated by generating_seeds
- if it gives you an error about where crashes are stored, `echo core | sudo tee /proc/sys/kernel/core_pattern`

Fuzzing with multiple cores 
- running AFL as above runs a single instance on a single core
- can run once per core natively w AFL
- on first instance of fuzzer (master) include `-M fuzzer00`
- on all following include `-S fuzzer01` (incrementing number)
- leave at least a core or two or system may crash (i can run 11 instances seemingly mostly stable)


CmakeLists.txt: 
```
cmake_minimum_required(VERSION 3.13)


set(CMAKE_C_COMPILER   afl-clang-fast)     
set(CMAKE_CXX_COMPILER afl-clang-fast++)  

project(udp_example C)                   

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS}   -fsanitize=address -fsanitize=undefined -g -O2")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=address -fsanitize=undefined -g -O2")

set(CMAKE_C_STANDARD 11)

find_package(MAVLink REQUIRED)

add_executable(udp_example udp_example.c)
target_link_libraries(udp_example PRIVATE MAVLink::mavlink)

```

